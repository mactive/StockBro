<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>AutoComplate</title>

    <!-- libraries -->
    <link href="css/autocomplate.css" rel="stylesheet" type="text/css">
</head>
<body>
<section>
    <div id="example">
        <h3>Example</h3>
        <form action="#">
            <input type="text" placeholder="Stock symbol or short" id="plugin" onkeyup="this.value=this.value.toLocaleUpperCase()"/>
        </form>
    </div>
    <div id="selected">
        <h3>Selected Item</h3>
        <p></p>
    </div>
    <div id="chart">
        <img src="" alt="">
    </div>
</section>

</body>
<script type="text/javascript" src="http://code.jquery.com/jquery-1.9.1.js"></script>
<script type="text/javascript" src="http://underscorejs.org/underscore-min.js"></script>
<script type="text/javascript" src="http://backbonejs.org/backbone-min.js"></script>
<script src="/js/backbone.autocomplete.js"></script>
<script src="/js/stock.list.objects.js"></script>
<script type="text/javascript">
    $(function () {

        /* ================================
         * AutoComplate 
         * ================================ 
         */ 

        var Plugin = Backbone.Model.extend({
            label: function () {
                return this.get("symbol") +"  "+ this.get("short") ;
            },
            label_for_show: function(){
                return this.get("symbol") +" "+ this.get("name") ;
            }
        });

        var PluginCollection = Backbone.Collection.extend({
            model: Plugin
        });

        // object {"symbol":"sz000030","short":"FAGF","name":"富奥股份"},
        var plugins = new PluginCollection(STOCK_LIST_OBJECTS);

        new AutoCompleteView({
            input: $("#plugin"),
            model: plugins,
            onSelect: function (model) {
                // AutoComplate list
                $("#selected").show().find("p").html(model.label_for_show());
                // Chart Image
                $("#chart").find("img").attr('src','http://chart.7878.com/kd/'+model.get("symbol")+'.gif');
            }
        }).render();


        /* ================================
         * fetch 
         * ================================ 
         */ 

        window.AppModel=Backbone.Model.extend({
            initialize:function(){
                console.log('create a model');
                this.bind("change:Name",function(){
                    var name=this.get('Name');
                    alert('你改变了name属性为：'+name);
                });
                this.bind('error',function(model,error){
                    alert(error);
                })
            },
            defaults:{
                n:'初始值',
                ID:'初始ID'
            },
        //  url:'http://localhost:8880/backbone'
        })
        window.AppCollection=Backbone.Collection.extend({
            model:AppModel,
            url:'http://api.stockpro.com/stock/realtime/ddd',
            initialize:function(){
                this.bind('reset',this.showAll);
                this.bind('add',this.showAll);
            },
            showAll:function(){
                this.each(function(model){
                    alert(model.get('n')+','+model.get('ID'))
                })
            },
        })

        $(function(){
            var test=new AppCollection();
         test.fetch();
            // test.fetch({url:'http://api.stockpro.com/stock/realtime/ddd',
            //     success:function(collection,response){
            //         collection.each(function(book){
            //             alert(book.get('n'));
            //         })
            //     },
            //     error:function(collection, response){
            //         console.log(collection);
            //         console.log(response);
            //         alert('error');
            //     }

            // })
        })


    });
</script>

</html>